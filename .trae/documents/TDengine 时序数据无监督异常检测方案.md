# 异常检测任务实施计划

根据您的需求，我将设计一个基于 PyOD 的无监督异常检测方案，针对 TDengine 中的 7 天风机时序数据进行监测。

## 1. 模型选择 (基于 `README_Models.md`)
考虑到数据量（132万行）、时序特性和无监督需求，我推荐以下模型：
*   **ECOD (Empirical Cumulative Distribution Functions)**:
    *   **理由**: 极快，无参数，适合大规模数据，且具有良好的可解释性（可以看到是哪个变量导致异常）。
*   **IForest (Isolation Forest)**:
    *   **理由**: 工业界标准的异常检测基线模型，擅长处理高维数据，鲁棒性强。

## 2. 训练与验证设计
为了验证模型的有效性，我们将采用“**历史训练-未来监测**”的模式，并利用数据中的**故障编码**作为验证依据（Ground Truth）。

*   **数据集划分**:
    *   **训练集 (Train)**: 前 5 天 (2026-01-22 至 2026-01-26)。假设这段时间大部分为正常运行状态，让模型学习“正常”的模式。
    *   **测试集 (Test)**: 后 2 天 (2026-01-27 至 2026-01-28)。用于模拟实时监测，检测是否有异常发生。
*   **特征工程**:
    *   **输入特征**: 选取传感器读数（如温度、风速、压力、电流等）。
    *   **验证标签**: 剔除 `gu` 到 `hx` (故障编码) 以及 `ea` (运行模式) 等状态列，**不参与训练**，仅用于后续验证。如果模型检测出的高异常分数时刻对应了故障编码非零时刻，说明模型有效。
*   **流程**:
    1.  **连接数据库**: 使用 `taosws` 读取数据。
    2.  **预处理**: 映射列名，分离特征列和故障标签列，处理缺失值。
    3.  **模型训练**: 在训练集上训练 ECOD 和 IForest。
    4.  **异常监测**: 对测试集计算异常分数 (Anomaly Score)。
    5.  **验证**: 将异常分数与故障发生时间进行对比可视化。

## 3. 拟创建的文件
我将为您创建以下 Python 脚本：
*   `d:\Git\prodtest\examples\taos\detect_anomalies.py`: 包含完整的数据加载、训练、预测和可视化流程。

## 4. 执行步骤
1.  **确认环境**: 确保已安装 `pyod`, `taosws`, `pandas`, `matplotlib`。
2.  **编写代码**: 实现上述逻辑。
3.  **运行脚本**: 您可以在本地运行该脚本，查看生成的图表和统计结果。

这个方案既满足了“无监督”的要求，又利用了数据中潜在的故障标记进行了“自我验证”。是否同意执行此计划？